"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[383,502],{61502:function(e,n,i){i.r(n),i.d(n,{default:function(){return X},useShadowRoot:function(){return Q},useWebComponentInfo:function(){return G}});var r=i(29439),t=i(74165),o=i(15861),l=i(24530),s=i(24717),a=i(61724);function u(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=(0,l.Qc)(e),t=(0,s.Vn)(r,{Field:{enter:function(e){var r;if(null!==e&&void 0!==e&&null!==(r=e.directives)&&void 0!==r&&r.find((function(e){var r,t,o,l,s=e.name.value,a=null===(r=e.arguments)||void 0===r?void 0:r[0].name.value,u=null===(t=e.arguments)||void 0===t||null===(o=t[0].value)||void 0===o?void 0:o.value,c=null===(l=e.arguments)||void 0===l?void 0:l[0];if("since"===s&&"version"===a){if(i(u))return!0}else if("deprecatedSince"===s&&"version"===a){var d="StringValue"===(null===c||void 0===c?void 0:c.value.kind)?null===c||void 0===c?void 0:c.value.value:n[null===c||void 0===c?void 0:c.value.name.value];if(!i(d))return!0}else if("skipOnClient"===s&&"if"===a){if("BooleanValue"===(null===c||void 0===c?void 0:c.value.kind)&&c.value.value)return!0;if("Variable"===(null===c||void 0===c?void 0:c.value.kind)&&n[c.value.name.value])return!0}return!1})))return null},leave:function(e){var n;if(e.selectionSet&&"SelectionSet"===e.selectionSet.kind&&0===(null===(n=e.selectionSet.selections)||void 0===n?void 0:n.length))return null}},Directive:{leave:function(e){var n=e.name.value;if(["since","deprecatedSince","skipOnClient"].includes(n))return null}}}),o={};return(0,s.Vn)(t,{Variable:function(e){o[e.name.value]=(o[e.name.value]||0)+1}}),t=(0,s.Vn)(t,{VariableDefinition:{enter:function(e){if(o[e.variable.name.value]<=1)return null}}}),(0,a.S)(t)}var c=i(41011);c.RelayFeatureFlags.ENABLE_RELAY_RESOLVERS=!0;var d=function(){var e=(0,o.Z)((0,t.Z)().mark((function e(n,i){var r,o,l,s,a,c;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==globalThis.backendaiclient){e.next=3;break}return e.next=3,new Promise((function(e){document.addEventListener("backend-ai-connected",(function n(){document.removeEventListener("backend-ai-connected",n),e(void 0)}))}));case 3:return l=u(n.text||"",i,(function(e){var n;return!(null!==(n=globalThis.backendaiclient)&&void 0!==n&&n.isManagerVersionCompatibleWith(e))})),s={query:l,variables:i},a=null===(r=globalThis.backendaiclient)||void 0===r?void 0:r.newSignedRequest("POST","/admin/gql",s),e.next=8,null===(o=globalThis.backendaiclient)||void 0===o?void 0:o._wrapWithPromise(a,!1,null,1e4,0).catch((function(e){}));case 8:if(e.t0=e.sent,e.t0){e.next=11;break}e.t0={};case 11:return c=e.t0,e.abrupt("return",c);case 13:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}();var m,v=new c.Environment({network:c.Network.create(d,void 0),store:new c.Store(new c.RecordSource)}),p=i(80382),h=i(27340),g=i(41239),f=i(47226),x=i(49883),y=i(66670),Z=i(99517),b=i.n(Z),j=(i(24989),i(79354)),k=i.n(j),_=i(79748),P=i.n(_),w=i(51714),S=i.n(w),F=i(63540),C=i.n(F),T=i(18272),E=i.n(T),V=i(9666),I=i.n(V),N=i(64447),M=i(13881),A=i(4519),R=i(81748),K=i(87112),D=i(16980),O=i(51843),z=i(12674),q=i(55144),B=i(73181),L=i(2556);b().extend(I()),b().extend(k()),b().extend(P()),b().extend(S()),b().extend(E()),b().extend(C());var U=A.createContext(null),W=A.createContext(null),Q=function(){return A.useContext(W)},G=function(){return A.useContext(U)},$=new K.QueryClient({defaultOptions:{queries:{suspense:!0,refetchOnWindowFocus:!1,retry:!1}}});N.ZP.use(R.Db).use(M.Z).init({backend:{loadPath:"/resources/i18n/{{lng}}.json"},lng:(null===globalThis||void 0===globalThis||null===(m=globalThis.backendaioptions)||void 0===m?void 0:m.get("current_language"))||"en",fallbackLng:"en",interpolation:{escapeValue:!1},react:{transSupportBasicHtmlNodes:!0,transKeepBasicHtmlNodesFor:["br","strong","span","code","p"]}});var H=function(){var e=(0,z.s0)();return(0,A.useLayoutEffect)((function(){var n=function(n){var i=n.detail;e(i,{replace:!0})};return document.addEventListener("react-navigate",n),function(){document.removeEventListener("react-navigate",n)}}),[e]),null},X=function(e){var n=e.children,i=e.value,t=e.styles,o=e.shadowRoot,l=e.dispatchEvent,s=(0,A.useMemo)((function(){return(0,h.Df)()}),[]),a=function(){var e,n=(0,A.useState)(null===globalThis||void 0===globalThis||null===(e=globalThis.backendaioptions)||void 0===e?void 0:e.get("current_language")),i=(0,r.Z)(n,2),t=i[0],o=i[1],l=(0,R.$G)().i18n;return(0,A.useEffect)((function(){setTimeout((function(){return null===l||void 0===l?void 0:l.changeLanguage(t)}),0),b().locale(t)}),[]),(0,A.useEffect)((function(){var e=function(e){var n,i;o(null===e||void 0===e||null===(n=e.detail)||void 0===n?void 0:n.lang);var r=(null===e||void 0===e||null===(i=e.detail)||void 0===i?void 0:i.lang)||"en";null===l||void 0===l||l.changeLanguage(r),b().locale(r)};return window.addEventListener("langChanged",e),function(){return window.removeEventListener("langChanged",e)}}),[l]),[t]}(),u=(0,r.Z)(a,1)[0],c=(0,p.x)(),d=(0,A.useMemo)((function(){return{value:i,dispatchEvent:l,moveTo:function(e,n){l("moveTo",{path:e,params:n})}}}),[i,l]);return(0,L.jsx)(L.Fragment,{children:v&&(0,L.jsx)(D.RelayEnvironmentProvider,{environment:v,children:(0,L.jsxs)(A.StrictMode,{children:[(0,L.jsxs)("style",{children:[t,".anticon {\n  display: inline-block;\n  color: inherit;\n  font-style: normal;\n  line-height: 0;\n  text-align: center;\n  text-transform: none;\n  vertical-align: -0.125em;\n  text-rendering: optimizeLegibility;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.anticon > * {\n  line-height: 1;\n}\n\n.anticon svg {\n  display: inline-block;\n}\n\n.anticon::before {\n  display: none;\n}\n\n.anticon .anticon-icon {\n  display: block;\n}\n\n.anticon[tabindex] {\n  cursor: pointer;\n}\n\n.anticon-spin::before,\n.anticon-spin {\n  display: inline-block;\n  -webkit-animation: loadingCircle 1s infinite linear;\n  animation: loadingCircle 1s infinite linear;\n}\n\n@-webkit-keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n/* fix: fixed column shadow display outside of a table wrapper */\n.ant-table-wrapper {\n  border-radius: 8px 8px 0 0;\n  overflow: hidden;\n}\n\n/* fix: the tooltip does not appear in the `<Form.Item tooltip={'something'}` when the popup container is a parent node of the trigger node. */\n.ant-form-item-label {\n  overflow: unset !important;\n}\n"]}),(0,L.jsx)(K.QueryClientProvider,{client:$,children:(0,L.jsx)(W.Provider,{value:o,children:(0,L.jsx)(U.Provider,{value:d,children:(0,L.jsx)(g.ZP,{getPopupContainer:function(e){return(null===e||void 0===e?void 0:e.parentNode)||o},locale:"ko"===u?y.Z:x.Z,theme:c,children:(0,L.jsx)(f.Z,{children:(0,L.jsx)(h.V9,{container:o,cache:s,children:(0,L.jsx)(A.Suspense,{fallback:"",children:(0,L.jsx)(O.VK,{children:(0,L.jsxs)(q.QueryParamProvider,{adapter:B.Q,options:{},children:[(0,L.jsx)(H,{}),n]})})})})})})})})})]})})})}},73340:function(e,n,i){i.r(n);var r=function(){var e=[{alias:null,args:null,concreteType:"ResourcePreset",kind:"LinkedField",name:"resource_presets",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"shared_memory",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ResourcePresetSelectQuery",selections:e,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"ResourcePresetSelectQuery",selections:e},params:{cacheID:"bd89430b9924d926a1b8e91191746b4f",id:null,metadata:{},name:"ResourcePresetSelectQuery",operationKind:"query",text:"query ResourcePresetSelectQuery {\n  resource_presets {\n    name\n    resource_slots\n    shared_memory\n  }\n}\n"}}}();r.hash="9841642e96d89476c2848bfb093ed9c5",n.default=r},750:function(e,n,i){i.r(n);var r={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderPermissionTag_VFolder",selections:[{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null}],type:"VirtualFolder",abstractKey:null,hash:"d3b0f85629ac8c6f45ef363938f66067"};n.default=r},25338:function(e,n,i){i.r(n);var r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"accessKey"}],n=[{alias:null,args:[{kind:"Variable",name:"access_key",variableName:"accessKey"}],concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"concurrency_used",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksUsingRelay_KeyPairQuery",selections:n,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksUsingRelay_KeyPairQuery",selections:n},params:{cacheID:"1f8fc324e9907111de581f5cd2dc3640",id:null,metadata:{},name:"hooksUsingRelay_KeyPairQuery",operationKind:"query",text:"query hooksUsingRelay_KeyPairQuery(\n  $accessKey: String!\n) {\n  keypair(access_key: $accessKey) {\n    id\n    resource_policy\n    concurrency_used\n  }\n}\n"}}}();r.hash="d8f5c91f0fc46a3366f57566ab688d81",n.default=r},94177:function(e,n,i){i.r(n);var r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"max_containers_per_session",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_concurrent_sessions",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksUsingRelay_KeyPairResourcePolicyQuery",selections:n,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksUsingRelay_KeyPairResourcePolicyQuery",selections:n},params:{cacheID:"ad7039c1935637fe3f3841f0ea8bf347",id:null,metadata:{},name:"hooksUsingRelay_KeyPairResourcePolicyQuery",operationKind:"query",text:"query hooksUsingRelay_KeyPairResourcePolicyQuery(\n  $name: String!\n) {\n  keypair_resource_policy(name: $name) {\n    max_containers_per_session\n    max_concurrent_sessions\n  }\n}\n"}}}();r.hash="f3f7364c63aefe9b03111b584c48c103",n.default=r},10383:function(e,n,i){i.r(n),i.d(n,{default:function(){return vn}});var r,t,o,l,s=i(74165),a=i(4942),u=i(15861),c=i(29439),d=i(1413),m=i(44925),v=i(83249),p=i(69080),h=i(44036),g=i(92171),f=i(53066),x=i(32048),y=i.n(x),Z=i(4519),b=i(2556),j=["status","extraButtonTitle","onClickExtraButton","extra","style"],k=function(e){var n=e.status,i=void 0===n?"default":n,r=e.extraButtonTitle,t=e.onClickExtraButton,o=e.extra,l=e.style,s=(0,m.Z)(e,j),a=h.Z.useToken().token,u=o||r&&(0,b.jsx)(g.ZP,{type:"link",icon:"error"===i?(0,b.jsx)(v.Z,{twoToneColor:a.colorError}):"warning"===i?(0,b.jsx)(p.Z,{twoToneColor:a.colorWarning}):void 0,onClick:t,children:r})||void 0;return(0,b.jsx)(f.Z,(0,d.Z)({style:y().extend(l,{borderColor:"error"===i?a.colorError:"warning"===i?a.colorWarning:"success"===i?a.colorSuccess:null===l||void 0===l?void 0:l.borderColor}),extra:u},s))},_=i(99821),P=i(66957),w=i(99517),S=i.n(w),F=["value","onChange","localFormat"],C=function(e){var n=e.value,i=e.onChange,r=e.localFormat,t=(0,m.Z)(e,F),o=(0,_.Z)({value:n,onChange:i}),l=(0,c.Z)(o,2)[1];return(0,b.jsx)(P.Z,(0,d.Z)({value:n?S()(n):void 0,onChange:function(e){var n,i=r?null===e||void 0===e?void 0:e.format():null===e||void 0===e||null===(n=e.tz())||void 0===n?void 0:n.toISOString();l(i)}},t))},T=i(61502),E=i(99277),V=i(74860),I=i(20558),N=i(57054),M=i(38818),A=i(81748),R=["formItemProps"],K=["key","name"],D=function(e){var n=e.formItemProps,i=(0,m.Z)(e,R),r=(0,Z.useRef)(null),t=(0,A.$G)().t;return(0,b.jsx)(N.Z.List,(0,d.Z)((0,d.Z)({},i),{},{children:function(e,o){var l=o.add,s=o.remove;return(0,b.jsxs)(E.Z,{direction:"column",gap:"xs",align:"stretch",children:[e.map((function(o,l){var a=o.key,u=o.name,c=(0,m.Z)(o,K);return(0,b.jsxs)(E.Z,{direction:"row",align:"baseline",gap:"xs",children:[(0,b.jsx)(N.Z.Item,(0,d.Z)((0,d.Z)((0,d.Z)({},c),{},{style:{marginBottom:0,flex:1},name:[u,"variable"],rules:[{required:!0,message:t("session.launcher.EnterEnvironmentVariable")},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:t("session.launcher.EnvironmentVariableNamePatternError")},function(e){var n=e.getFieldValue;return{validator:function(e,r){var o=y().map(n(i.name),(function(e){return null===e||void 0===e?void 0:e.variable}));return o.length>0&&y().filter(o,(function(e){return e===r})).length>1?Promise.reject(t("session.launcher.EnvironmentVariableDuplicateName")):Promise.resolve()}}}]},n),{},{children:(0,b.jsx)(M.Z,{ref:l===e.length-1?r:null,placeholder:"Variable"})})),(0,b.jsx)(N.Z.Item,(0,d.Z)((0,d.Z)({},c),{},{name:[u,"value"],style:{marginBottom:0,flex:1},rules:[{required:!0,message:"Enter value"}],children:(0,b.jsx)(M.Z,{placeholder:"Value"})})),(0,b.jsx)(V.Z,{onClick:function(){return s(u)}})]},a)})),(0,b.jsx)(N.Z.Item,{noStyle:!0,children:(0,b.jsx)(g.ZP,{type:"dashed",onClick:function(){l(),setTimeout((function(){r.current&&r.current.focus()}),0)},icon:(0,b.jsx)(I.Z,{}),block:!0,children:"Add variable"})})]})}}))},O=i(15008),z=i(14001),q=i(36459),B=i(87760),L=i(19427),U=i(82548),W=["value"],Q=function(e){var n=e.value,i=(0,m.Z)(e,W),r=parseInt(n),t=r>=1024&&r<=65535;return(0,b.jsx)(U.Z,(0,d.Z)({color:t?void 0:"red"},i))},G=function(e){var n=Object.assign({},((0,q.Z)(e),e)),i=(0,A.$G)().t,r=(0,B.Dj)();return(0,b.jsx)(N.Z.Item,(0,d.Z)((0,d.Z)({label:i("session.launcher.PreOpenPortTitle"),name:"ports",tooltip:(0,b.jsx)(A.cC,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:i("session.launcher.PreOpenPortRangeGuide"),rules:[{max:r._config.maxCountForPreopenPorts,type:"array",message:i("session.launcher.PreOpenPortMaxCountLimit",{count:r._config.maxCountForPreopenPorts})},function(e){e.getFieldValue;return{validator:function(e,n){return y().every(n,(function(e){var n=parseInt(e);return n>=1024&&n<=65535}))?Promise.resolve():Promise.reject(new Error(i("session.launcher.PreOpenPortRange")))}}}]},n),{},{children:(0,b.jsx)(L.Z,{mode:"tags",tagRender:function(e){return(0,b.jsx)(Q,{closable:e.closable,onClose:e.onClose,onMouseDown:function(e){e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})}))},$=i(43255),H=i(1839),X=i(16980),J=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{fetchPolicy:"store-and-network"},n=(0,B.Kr)("first"),o=(0,c.Z)(n,2),l=o[0],s=o[1],a=(0,B.Dj)(),u=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fetchPolicy:"store-and-network"},t=(0,B.Kr)("first"),o=(0,c.Z)(t,2),l=o[0],s=o[1];return[(0,X.useLazyLoadQuery)(void 0!==r?r:r=i(25338),{accessKey:e},(0,d.Z)((0,d.Z)({},n),{},{fetchKey:l+n.fetchKey})).keypair,{refresh:(0,Z.useCallback)((function(){s()}),[s])}]}(null===a||void 0===a?void 0:a._config.accessKey),m=(0,c.Z)(u,1)[0];return[{keypairResourcePolicy:(0,X.useLazyLoadQuery)(void 0!==t?t:t=i(94177),{name:(null===m||void 0===m?void 0:m.resource_policy)||""},(0,d.Z)((0,d.Z)({},e),{},{fetchKey:l+e.fetchKey})).keypair_resource_policy||{},keypair:m||{}},{refresh:(0,Z.useCallback)((function(){s()}),[s])}]},Y=i(50164),ee=i(67668),ne=i(66653),ie=i(70389),re=["dynamicSteps","units","disableAutoUnit","min","max"],te=function(e){var n=e.dynamicSteps,i=void 0===n?[1,2,4,8,16,32,64,128,256,512]:n,r=e.units,t=void 0===r?["m","g","t","p"]:r,o=e.disableAutoUnit,l=void 0!==o&&o,s=e.min,a=void 0===s?"0m":s,u=e.max,v=void 0===u?"300p":u,p=(0,m.Z)(e,re),h=(0,_.Z)(p,{defaultValue:"0g"}),g=(0,c.Z)(h,2),f=g[0],x=g[1],j=null===f||void 0===f?[null,null]:(0,$.n2)(f),k=(0,c.Z)(j,2),P=k[0],w=k[1],S=(0,ee.Z)(w),F=w||S||t[0],C=(0,$.n2)(a),T=(0,c.Z)(C,2),E=T[0],V=T[1],I=(0,$.n2)(v),N=(0,c.Z)(I,2),M=N[0],A=N[1],R=(0,Z.useRef)(null);return(0,Z.useEffect)((function(){if(R.current){var e=function(e){var n,i=null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value;/^\d+(g|m)$/.test(i)&&x(i)},n=R.current;return null===n||void 0===n||n.addEventListener("input",e),function(){null===n||void 0===n||n.removeEventListener("input",e)}}}),[R,P,w,x]),(0,b.jsx)(ne.Z,(0,d.Z)((0,d.Z)({ref:R},p),{},{value:P,onChange:function(e){x(null===e||void 0===e?e:"".concat(e).concat(F))},max:A===F?M:(0,$.PZ)(v,F).number,min:V===F?E:(0,$.PZ)(a,F).number,addonAfter:(0,b.jsx)(L.Z,{tabIndex:-1,value:F,onChange:function(e){x("".concat(P).concat(e))},onDropdownVisibleChange:function(e){(e&&null===f||void 0===f)&&x("0".concat(F))},options:y().map(t,(function(e){return{value:e,label:(0,b.jsx)(ie.Z.Text,{style:{fontFamily:"'SFMono-Regular',Consolas,'Liberation Mono',Menlo,Courier,monospace"},children:e.toUpperCase()+"iB"})}})),suffixIcon:t.length>1?void 0:null,open:t.length>1&&void 0,style:{cursor:t.length>1?void 0:"default"}}),step:0,onStep:function(e,n){var r,o=y().isNull(P)||y().isUndefined(P)?0:P,s=y().sortedIndex(y().sortBy(i),o);r="up"===n.type?o===i[s]?s+1:s:s-1;var a=t.indexOf(F);if(!l&&r<0)if(0===a)x("0".concat(F));else{var u=i[i.length-1],c=t[a-1];x("".concat(u).concat(c))}else if(!l&&r>i.length-1)if(a===t.length-1)x("".concat(o+("up"===n.type?1:-1)).concat(A));else{var d=i[0],m=t[a+1];x("".concat(d).concat(m))}else if(r>=0&&r<i.length){var v=i[r];V===F&&v<E?v=E:A===F&&v>M&&(v=M),x("".concat(v).concat(F))}}}))},oe=i(31603),le=["min","max","warn","units","extraMarks","hideSlider"],se=function(e){var n=e.min,i=void 0===n?"0m":n,r=e.max,t=void 0===r?"32g":r,o=e.warn,l=e.units,s=void 0===l?["m","g"]:l,u=e.extraMarks,v=e.hideSlider,p=(0,m.Z)(e,le),g=(0,_.Z)(p,{defaultValue:"0g"}),f=(0,c.Z)(g,2),x=f[0],j=f[1],k=h.Z.useToken().token,P=(0,Z.useMemo)((function(){return(0,$.PZ)(i,"g",2)}),[i]),w=(0,Z.useMemo)((function(){return(0,$.PZ)(t,"g",2)}),[t]),S=(0,Z.useMemo)((function(){return(0,$.PZ)(x||"0g","g",2)}),[x]);return(0,b.jsxs)(E.Z,{direction:"row",gap:"md",children:[(0,b.jsx)(E.Z,{style:{flex:2,minWidth:190},direction:"column",align:"stretch",children:(0,b.jsx)(te,(0,d.Z)((0,d.Z)({},p),{},{min:i,max:t,units:s,value:x,onChange:function(e){j(e)},style:{minWidth:130}}))}),(0,b.jsx)(E.Z,{direction:"column",align:"stretch",style:(0,d.Z)({flex:3},v&&{visibility:"hidden",height:0}),children:(0,b.jsx)(E.Z,{direction:"column",align:"stretch",children:(0,b.jsx)(oe.Z,{max:null===w||void 0===w?void 0:w.number,trackStyle:o&&{backgroundColor:(0,$.p)(o,x||"0b")<0?k.colorWarning:void 0}||void 0,railStyle:{},step:.125,value:null===S||void 0===S?void 0:S.number,tooltip:{formatter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e<1?"".concat((1024*e).toFixed(2)," MiB"):"".concat(e.toFixed(2)," GiB")}},onChange:function(e){null!==P&&void 0!==P&&P.number&&P.number>e?j(i):j(e<1?"".concat(1024*e,"m"):"".concat(e,"g"))},marks:(0,d.Z)((0,d.Z)((0,d.Z)({},P&&y().isNumber(null===P||void 0===P?void 0:P.number)&&(0,a.Z)({},P.number,{style:{color:k.colorTextSecondary},label:0===P.number?P.number:P.number>=1?P.number+"g":1024*P.number+"m"})),u),(null===w||void 0===w?void 0:w.number)&&(0,a.Z)({},w.number,{style:{color:k.colorTextSecondary},label:0===w.number?w.number:w.number>=1?w.number+"g":1024*w.number+"m"}))})})})]})},ae=["min","max","step","disabled","inputNumberProps","sliderProps"],ue=function(e){var n=e.min,i=e.max,r=e.step,t=e.disabled,o=e.inputNumberProps,l=e.sliderProps,s=(0,m.Z)(e,ae),a=(0,_.Z)(s),u=(0,c.Z)(a,2),v=u[0],p=u[1];return(0,Z.useEffect)((function(){1===r&&v%1!==0&&p(Math.round(v))}),[r]),(0,b.jsxs)(E.Z,{direction:"row",gap:"md",children:[(0,b.jsx)(E.Z,{style:{flex:2,minWidth:190},align:"stretch",direction:"column",children:(0,b.jsx)(ne.Z,(0,d.Z)({max:i,min:n,step:r,disabled:t,value:v,onChange:p},o))}),(0,b.jsx)(E.Z,{direction:"column",align:"stretch",style:{flex:3},children:(0,b.jsx)(oe.Z,(0,d.Z)({max:i,min:0,step:r,disabled:t,value:v,onChange:function(e){void 0!==n&&e<n||p(e)}},l))})]})},ce=i(61815),de=i(96732),me=i(61749),ve=i(73519),pe=function(e){var n=Object.assign({},((0,q.Z)(e),e)),r=(0,B.Kr)("first"),t=(0,c.Z)(r,2),l=t[0],s=t[1],a=(0,ve.Z)(s,{wait:3e3,trailing:!1,leading:!0}).run,u=(0,H.T6)(),m=(0,c.Z)(u,1)[0],v=(0,Z.useTransition)(),p=(0,c.Z)(v,2),h=p[0],g=p[1],f=(0,X.useLazyLoadQuery)(void 0!==o?o:o=i(73340),{},{fetchKey:l,fetchPolicy:"first"===l?"store-and-network":"network-only"}).resource_presets;return(0,b.jsx)(L.Z,(0,d.Z)((0,d.Z)({loading:h,options:[{value:"custom",label:(0,b.jsxs)(E.Z,{gap:"xs",style:{display:"inline-flex"},children:[(0,b.jsx)(me.Z,{})," Custom"]})},{label:"Preset",options:y().map(f,(function(e,n){var i=JSON.parse(null===e||void 0===e?void 0:e.resource_slots);return{value:null===e||void 0===e?void 0:e.name,label:(0,b.jsxs)(E.Z,{direction:"row",justify:"between",gap:"xs",children:[null===e||void 0===e?void 0:e.name,(0,b.jsx)(E.Z,{direction:"row",gap:"xxs",style:{color:"black",opacity:1===n?.5:1},children:y().map(y().omitBy(i,(function(e,n){return y().isEmpty(m[n])})),(function(e,n){return(0,b.jsx)(de.ZP,{type:n,value:e,hideTooltip:!0},n)}))})]}),preset:e}}))}],showSearch:!0},n),{},{onDropdownVisibleChange:function(e){e&&(console.log(e),g((function(){a()})))}}))},he=i(58021),ge=i(62708),fe=i(83799),xe=i(35492),ye=i(2704),Ze=i(22733),be="64m",je=function(e){return void 0===e||"Infinity"===e||"NaN"===e?void 0:y().toNumber(e)},ke=function(e){var n,i,r,t,o,l,m,v,p,g,x,j,k,_,P,w,S,F,C,T,V,I,M=e.enableNumOfSessions,R=N.Z.useFormInstance(),K=(0,A.$G)().t,D=h.Z.useToken().token,O=(0,B.Dj)(),z=(0,H.T6)(),q=(0,c.Z)(z,1)[0],U=y().omit(q,["cpu","mem","shmem"]),W=J(),Q=(0,c.Z)(W,1)[0],G=Q.keypair,X=Q.keypairResourcePolicy,ee=(0,B.qh)(),ne=(0,Z.useState)(R.getFieldValue("resourceGroup")),ie=(0,c.Z)(ne,2),re=ie[0],te=ie[1],oe=(0,Z.useTransition)(),le=(0,c.Z)(oe,2),ae=le[0],me=le[1],ve=N.Z.useWatch(["environments","image"],{form:R,preserve:!0}),he=y().filter(null===ve||void 0===ve?void 0:ve.resource_limits,(function(e){return!!e&&!y().includes(["cpu","mem","shmem"],e.key)})),ke=(null===(n=y().find(null===ve||void 0===ve?void 0:ve.resource_limits,(function(e){return"mem"===(null===e||void 0===e?void 0:e.key)})))||void 0===n?void 0:n.min)||"0g",Pe=(0,Y.h)({queryKey:["check-resets",ee.name,re],queryFn:function(){return re?O.resourcePreset.check({group:ee.name,scaling_group:re}):void 0},staleTime:0,suspense:!y().isEmpty(re)}).data,we=(0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)({},null!==q&&void 0!==q&&q.cpu?{cpu:{min:y().max([y().toNumber((null===(i=y().find(null===ve||void 0===ve?void 0:ve.resource_limits,(function(e){return"cpu"===(null===e||void 0===e?void 0:e.key)})))||void 0===i?void 0:i.min)||"0")]),max:y().min([O._config.maxCPUCoresPerContainer,je(null===Pe||void 0===Pe?void 0:Pe.keypair_limits.cpu),je(null===Pe||void 0===Pe?void 0:Pe.group_limits.cpu),y().isEmpty(null===Pe||void 0===Pe||null===(r=Pe.scaling_groups[re])||void 0===r||null===(t=r.using)||void 0===t?void 0:t.cpu)||y().isEmpty(null===Pe||void 0===Pe||null===(o=Pe.scaling_groups[re])||void 0===o||null===(l=o.remaining)||void 0===l?void 0:l.cpu)?void 0:y().toNumber(null===Pe||void 0===Pe||null===(m=Pe.scaling_groups[re])||void 0===m?void 0:m.using.cpu)+y().toNumber(null===Pe||void 0===Pe||null===(v=Pe.scaling_groups[re])||void 0===v?void 0:v.remaining.cpu)]),remaining:null!==(p=y().min([null===Pe||void 0===Pe?void 0:Pe.keypair_remaining.cpu,null===Pe||void 0===Pe?void 0:Pe.group_remaining.cpu,null===Pe||void 0===Pe?void 0:Pe.scaling_group_remaining.cpu]))&&void 0!==p?p:Number.MAX_SAFE_INTEGER}}:{}),null!==q&&void 0!==q&&q.mem?{mem:{min:(0,$.v3)((y().max([null===(g=(0,$.PZ)(ke,"b"))||void 0===g?void 0:g.number,(null===(x=(0,$.PZ)(be,"b"))||void 0===x?void 0:x.number)||0])||0)+"b",be)||"0b",max:y().min([O._config.maxMemoryPerContainer,je(null===Pe||void 0===Pe?void 0:Pe.keypair_limits.mem)&&(null===(j=(0,$.PZ)(je(null===Pe||void 0===Pe?void 0:Pe.keypair_limits.mem)+"","g"))||void 0===j?void 0:j.number),je(null===Pe||void 0===Pe?void 0:Pe.group_limits.mem)&&(null===(k=(0,$.PZ)(je(null===Pe||void 0===Pe?void 0:Pe.group_limits.mem)+"","g"))||void 0===k?void 0:k.number),y().isEmpty(null===Pe||void 0===Pe||null===(_=Pe.scaling_groups[re])||void 0===_||null===(P=_.using)||void 0===P?void 0:P.mem)||y().isEmpty(null===Pe||void 0===Pe||null===(w=Pe.scaling_groups[re])||void 0===w||null===(S=w.using)||void 0===S?void 0:S.mem)||null===(F=(0,$.PZ)(y().toNumber(null===Pe||void 0===Pe||null===(C=Pe.scaling_groups[re])||void 0===C?void 0:C.using.mem)+y().toNumber(null===Pe||void 0===Pe||null===(T=Pe.scaling_groups[re])||void 0===T?void 0:T.remaining.mem)+"b","g",2))||void 0===F?void 0:F.numberFixed])+"g",remaining:null!==(V=y().min([null===Pe||void 0===Pe?void 0:Pe.keypair_remaining.mem,null===Pe||void 0===Pe?void 0:Pe.group_remaining.mem,null===Pe||void 0===Pe?void 0:Pe.scaling_group_remaining.mem]))&&void 0!==V?V:Number.MAX_SAFE_INTEGER},shmem:{min:y().max([null===(I=y().find(null===ve||void 0===ve?void 0:ve.resource_limits,(function(e){return"shmem"===(null===e||void 0===e?void 0:e.key)})))||void 0===I?void 0:I.min,"64m"])}}:{}),y().reduce(U,(function(e,n,i){var r,t,o,l,s,a,u,c,d={"cuda.device":"maxCUDADevicesPerContainer","cuda.shares":"maxCUDASharesPerContainer","rocm.device":"maxROCMDevicesPerContainer","tpu.device":"maxTPUDevicesPerContainer","ipu.device":"maxIPUDevicesPerContainer","atom.device":"maxATOMDevicesPerContainer","warboy.device":"maxWarboyDevicesPerContainer"}[i]||"cuda.device";return e[i]={min:parseInt(null===(r=y().filter(he,(function(e){return(null===e||void 0===e?void 0:e.key)===i}))[0])||void 0===r?void 0:r.min)||0,max:y().min([O._config[d]||8,y().isEmpty(null===Pe||void 0===Pe||null===(t=Pe.scaling_groups[re])||void 0===t||null===(o=t.using)||void 0===o?void 0:o[i])||y().isEmpty(null===Pe||void 0===Pe||null===(l=Pe.scaling_groups[re])||void 0===l||null===(s=l.remaining)||void 0===s?void 0:s[i])?void 0:y().toNumber(null===Pe||void 0===Pe||null===(a=Pe.scaling_groups[re])||void 0===a?void 0:a.using[i])+y().toNumber(null===Pe||void 0===Pe||null===(u=Pe.scaling_groups[re])||void 0===u?void 0:u.remaining[i])]),remaining:null!==(c=y().min([y().toNumber(null===Pe||void 0===Pe?void 0:Pe.keypair_remaining[i]),y().toNumber(null===Pe||void 0===Pe?void 0:Pe.group_remaining[i]),y().toNumber(null===Pe||void 0===Pe?void 0:Pe.scaling_group_remaining[i])]))&&void 0!==c?c:Number.MAX_SAFE_INTEGER},e}),{})),{},{session:{min:1,max:y().min([X.max_concurrent_sessions,3]),remaining:(X.max_concurrent_sessions||3)-(G.concurrency_used||0)}});(0,Z.useEffect)((function(){var e,n,i,r,t,o,l;if(R.setFieldsValue({resource:{cpu:null===(e=we.cpu)||void 0===e?void 0:e.min,mem:(null===(n=(0,$.PZ)(((null===(i=(0,$.PZ)(null===(r=we.shmem)||void 0===r?void 0:r.min,"m"))||void 0===i?void 0:i.number)||0)+((null===(t=(0,$.PZ)(null===(o=we.mem)||void 0===o?void 0:o.min,"m"))||void 0===t?void 0:t.number)||0)+"m","g"))||void 0===n?void 0:n.number)+"g",shmem:null===(l=we.shmem)||void 0===l?void 0:l.min}}),he.length>0)if(y().find(he,(function(e){return(null===e||void 0===e?void 0:e.key)===R.getFieldValue(["resource","acceleratorType"])})))R.setFieldValue(["resource","accelerator"],we[R.getFieldValue(["resource","acceleratorType"])].min);else{var s,a=null===(s=y().filter(he,(function(e){return y().keys(q).includes(null===e||void 0===e?void 0:e.key)}))[0])||void 0===s?void 0:s.key;a&&(R.setFieldValue(["resource","accelerator"],we[a].min),R.setFieldValue(["resource","acceleratorType"],a))}R.validateFields().catch((function(){}))}),[ve]);var Se=function(e){(0,$.p)(e,"4g")>=0&&(0,$.p)(e,(0,$.v3)(ke,"1g")||"0b")>=0&&(0,$.p)("1g",be)>0?R.setFieldValue(["resource","shmem"],"1g"):R.setFieldValue(["resource","shmem"],be)};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(N.Z.Item,{name:"resourceGroup",label:K("session.ResourceGroup"),rules:[{required:!0}],children:(0,b.jsx)(ce.Z,{autoSelectDefault:!0,showSearch:!0,loading:ae,onChange:function(e){me((function(){te(e)}))}})}),(0,b.jsx)(N.Z.Item,{label:K("resourcePreset.ResourcePresets"),name:"allocationPreset",required:!0,style:{marginBottom:D.marginXS},children:(0,b.jsx)(pe,{onChange:function(e,n){var i,r,t,o,l=y().pick(JSON.parse((null===n||void 0===n||null===(i=n.preset)||void 0===i?void 0:i.resource_slots)||"{}"),y().keys(q));R.setFieldsValue({resource:(0,d.Z)((0,d.Z)({},l),{},{mem:null===(r=(0,$.PZ)(((null===l||void 0===l?void 0:l.mem)||0)+"b","g",2))||void 0===r?void 0:r.numberUnit,shmem:null===(t=(0,$.PZ)(((null===n||void 0===n||null===(o=n.preset)||void 0===o?void 0:o.shared_memory)||0)+"b","g",2))||void 0===t?void 0:t.numberUnit})})}})}),(0,b.jsx)(f.Z,{style:{marginBottom:D.margin},children:(0,b.jsx)(N.Z.Item,{shouldUpdate:function(e,n){return e.allocationPreset!==n.allocationPreset},noStyle:!0,children:function(e){var n,i,r,t,o,l,c,m,v,p,h,g=e.getFieldValue;return(0,b.jsxs)(b.Fragment,{children:[(null===q||void 0===q?void 0:q.cpu)&&(0,b.jsx)(N.Z.Item,{name:["resource","cpu"],label:K("session.launcher.CPU"),tooltip:{placement:"right",title:(0,b.jsx)(A.cC,{i18nKey:"session.launcher.DescCPU"})},required:!0,rules:[{required:!0},{type:"number",min:null===(n=we.cpu)||void 0===n?void 0:n.min},{warningOnly:null===(i=O._config)||void 0===i?void 0:i.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(n,i){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(we.cpu&&i>we.cpu.remaining)){e.next=4;break}return e.abrupt("return",Promise.reject(null!==(r=O._config)&&void 0!==r&&r.always_enqueue_compute_session?K("session.launcher.EnqueueComputeSessionWarning"):K("session.launcher.ErrorCanNotExceedRemaining",{amount:we.cpu.remaining})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,b.jsx)(ue,{inputNumberProps:{addonAfter:K("session.launcher.Core")},sliderProps:{marks:(0,d.Z)((0,d.Z)({},null!==(r=we.cpu)&&void 0!==r&&r.remaining?(0,a.Z)({},null===(t=we.cpu)||void 0===t?void 0:t.remaining,{label:(0,b.jsx)(_e,{})}):{}),{},(0,a.Z)({},null===(o=we.cpu)||void 0===o?void 0:o.min,null===(l=we.cpu)||void 0===l?void 0:l.min),null!==(c=we.cpu)&&void 0!==c&&c.max?(0,a.Z)({},null===(m=we.cpu)||void 0===m?void 0:m.max,{style:{color:D.colorTextSecondary},label:null===(v=we.cpu)||void 0===v?void 0:v.max}):{})},min:null===(p=we.cpu)||void 0===p?void 0:p.min,max:null===(h=we.cpu)||void 0===h?void 0:h.max})}),(null===q||void 0===q?void 0:q.mem)&&(0,b.jsxs)(N.Z.Item,{label:K("session.launcher.Memory"),tooltip:{placement:"right",props:{onClick:function(e){return e.preventDefault()}},title:(0,b.jsx)(E.Z,{direction:"column",onClick:function(e){return e.preventDefault()},children:(0,b.jsx)(A.cC,{i18nKey:"session.launcher.DescMemory"})})},required:!0,children:[(0,b.jsx)(N.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.resource.shmem!==n.resource.shmem},children:function(){var e,n,i,r,t,o;return(0,b.jsx)(N.Z.Item,{name:["resource","mem"],noStyle:!0,rules:[{required:!0},{validator:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(n,i){var r,t,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!y().isElement(i)&&null!==(r=we.mem)&&void 0!==r&&r.min&&(0,$.p)(i,(null===(t=we.mem)||void 0===t?void 0:t.min)||"0g")<0)){e.next=4;break}return e.abrupt("return",Promise.reject(K("session.launcher.MinMemory",{size:y().toUpper((null===(o=we.mem)||void 0===o?void 0:o.min)||"0g")})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()},{warningOnly:null===(e=O._config)||void 0===e?void 0:e.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(n,i){var r,t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!y().isElement(i)&&we.mem&&(0,$.p)(i,we.mem.remaining+"b")>0)){e.next=4;break}return e.abrupt("return",Promise.reject(null!==(r=O._config)&&void 0!==r&&r.always_enqueue_compute_session?K("session.launcher.EnqueueComputeSessionWarning"):K("session.launcher.ErrorCanNotExceedRemaining",{amount:(null===(t=(0,$.PZ)(we.mem.remaining+"b","g",3))||void 0===t?void 0:t.numberUnit)+"iB"})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,b.jsx)(se,{max:null===(n=we.mem)||void 0===n?void 0:n.max,min:null===(i=we.mem)||void 0===i?void 0:i.min,addonBefore:"MEM",extraMarks:(0,d.Z)({},null!==(r=we.mem)&&void 0!==r&&r.remaining?(0,a.Z)({},null===(t=(0,$.PZ)((null===(o=we.mem)||void 0===o?void 0:o.remaining)+"b","g",3))||void 0===t?void 0:t.numberFixed,{label:(0,b.jsx)(_e,{})}):{}),onChange:function(e){e&&R.getFieldValue("enabledAutomaticShmem")&&Se(e)}})})}}),(0,b.jsxs)(E.Z,{direction:"column",gap:"xxs",align:"start",children:[(0,b.jsxs)(E.Z,{direction:"row",gap:"xs",children:[K("session.launcher.EnableAutomaticShmem")," ",(0,b.jsx)(N.Z.Item,{noStyle:!0,name:"enabledAutomaticShmem",valuePropName:"checked",children:(0,b.jsx)(ge.Z,{size:"small",onChange:function(e){e&&Se(R.getFieldValue(["resource","mem"])||"0g")}})})]}),(0,b.jsx)(N.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.resource.mem!==n.resource.mem||e.enabledAutomaticShmem!==n.enabledAutomaticShmem},children:function(){var e;return(0,b.jsx)(N.Z.Item,{noStyle:!0,name:["resource","shmem"],hidden:R.getFieldValue("enabledAutomaticShmem"),tooltip:(0,b.jsx)(A.cC,{i18nKey:"session.launcher.DescSharedMemory"}),dependencies:[["resource","mem"]],rules:[{required:!0},{},{validator:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(n,i){var r,t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(y().isEmpty(null===(r=g("resource"))||void 0===r?void 0:r.mem)||y().isEmpty(i)||(0,$.p)(null===(t=g("resource"))||void 0===t?void 0:t.mem,i)>=0)){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:throw K("resourcePreset.SHMEMShouldBeSmallerThanMemory");case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,b.jsx)(se,{min:null===(e=we.shmem)||void 0===e?void 0:e.min,addonBefore:"SHM",max:R.getFieldValue(["resource","mem"])||"0g",hideSlider:!0})})}})]})]}),(0,b.jsx)(N.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,r;return(null===(i=e.resource)||void 0===i?void 0:i.acceleratorType)!==(null===(r=n.resource)||void 0===r?void 0:r.acceleratorType)||e.cluster_size!==n.cluster_size},children:function(e){var n,i,r,t,o,l,c=(0,e.getFieldValue)(["resource","acceleratorType"]);return(0,b.jsx)(N.Z.Item,{name:["resource","accelerator"],label:K("session.launcher.AIAccelerator"),tooltip:{placement:"right",title:(0,b.jsx)(A.cC,{i18nKey:"session.launcher.DescAIAccelerator"})},required:!0,rules:[{required:!0},{type:"number",min:(null===(n=we[c])||void 0===n?void 0:n.min)||0},{warningOnly:null===(i=O._config)||void 0===i?void 0:i.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(n,i){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(we[c]&&i>we[c].remaining)){e.next=4;break}return e.abrupt("return",Promise.reject(null!==(r=O._config)&&void 0!==r&&r.always_enqueue_compute_session?K("session.launcher.EnqueueComputeSessionWarning"):K("session.launcher.ErrorCanNotExceedRemaining",{amount:we[c].remaining})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,b.jsx)(ue,{sliderProps:{marks:(0,d.Z)((0,d.Z)({0:0},null!==(r=we[c])&&void 0!==r&&r.remaining?(0,a.Z)({},we[c].remaining,{label:(0,b.jsx)(_e,{})}):{}),{},(0,a.Z)({},null===(t=we[c])||void 0===t?void 0:t.max,null===(o=we[c])||void 0===o?void 0:o.max)),tooltip:{formatter:function(){return"".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0," ").concat(de.Ec[c])}}},min:0,max:null===(l=we[c])||void 0===l?void 0:l.max,step:y().endsWith(c,"shares")&&R.getFieldValue("cluster_size")<2?.1:1,inputNumberProps:{addonAfter:(0,b.jsx)(N.Z.Item,{noStyle:!0,name:["resource","acceleratorType"],initialValue:y().keys(U)[0],children:(0,b.jsx)(L.Z,{tabIndex:-1,suffixIcon:y().size(U)>1?void 0:null,popupMatchSelectWidth:!1,options:y().map(U,(function(e,n){return{value:n,label:de.Ec[n]||"UNIT",disabled:he.length>0&&!y().find(he,(function(e){return(null===e||void 0===e?void 0:e.key)===n}))}}))})})}})})}})]})}})}),M?(0,b.jsx)(f.Z,{style:{marginBottom:D.margin},children:(0,b.jsx)(N.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.cluster_size!==n.cluster_size},children:function(){var e,n,i,r,t,o,l,c,m;return(0,b.jsx)(N.Z.Item,{name:["num_of_sessions"],label:K("webui.menu.Sessions"),tooltip:(0,b.jsx)(A.cC,{i18nKey:"session.launcher.DescSession"}),required:!0,rules:[{required:!0},{warningOnly:null===(e=O._config)||void 0===e?void 0:e.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(n,i){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(we.session&&i>we.session.remaining)){e.next=4;break}return e.abrupt("return",Promise.reject(null!==(r=O._config)&&void 0!==r&&r.always_enqueue_compute_session?K("session.launcher.EnqueueComputeSessionWarning"):K("session.launcher.ErrorCanNotExceedRemaining",{amount:we.session.remaining})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,b.jsx)(ue,{inputNumberProps:{addonAfter:"#"},disabled:R.getFieldValue("cluster_size")>1,sliderProps:{marks:(0,d.Z)((0,d.Z)((0,a.Z)({},null===(n=we.session)||void 0===n?void 0:n.min,null===(i=we.session)||void 0===i?void 0:i.min),null!==(r=we.session)&&void 0!==r&&r.remaining?(0,a.Z)({},null===(t=we.session)||void 0===t?void 0:t.remaining,{label:(0,b.jsx)(_e,{})}):{}),{},(0,a.Z)({},null===(o=we.session)||void 0===o?void 0:o.max,null===(l=we.session)||void 0===l?void 0:l.max))},min:null===(c=we.session)||void 0===c?void 0:c.min,max:null===(m=we.session)||void 0===m?void 0:m.max})})}})}):null,O.supports("multi-container")&&(0,b.jsx)(N.Z.Item,{label:K("session.launcher.ClusterMode"),tooltip:(0,b.jsxs)(E.Z,{direction:"column",align:"start",children:[K("session.launcher.SingleNode"),(0,b.jsx)(A.cC,{i18nKey:"session.launcher.DescSingleNode"}),(0,b.jsx)(fe.Z,{style:{backgroundColor:D.colorBorder}}),K("session.launcher.MultiNode"),(0,b.jsx)(A.cC,{i18nKey:"session.launcher.DescMultiNode"})]}),required:!0,children:(0,b.jsx)(f.Z,{style:{marginBottom:D.margin},children:(0,b.jsxs)(xe.Z,{gutter:D.marginMD,children:[(0,b.jsx)(ye.Z,{xs:24,children:(0,b.jsx)(N.Z.Item,{name:"cluster_mode",required:!0,children:(0,b.jsxs)(Ze.ZP.Group,{onChange:function(e){R.validateFields().catch((function(){}))},children:[(0,b.jsx)(Ze.ZP.Button,{value:"single-node",children:K("session.launcher.SingleNode")}),(0,b.jsx)(Ze.ZP.Button,{value:"multi-node",children:K("session.launcher.MultiNode")})]})})}),(0,b.jsx)(ye.Z,{xs:24,children:(0,b.jsx)(N.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.cluster_mode!==n.cluster_mode},children:function(){var e,n,i,r,t=y().min([null===(e=we.cpu)||void 0===e?void 0:e.max,X.max_containers_per_session]),o="single-node"===R.getFieldValue("cluster_mode")?K("session.launcher.Container"):K("session.launcher.Node");return(0,b.jsx)(N.Z.Item,{name:"cluster_size",label:K("session.launcher.ClusterSize"),required:!0,rules:[{warningOnly:null===(n=O._config)||void 0===n?void 0:n.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(n,i){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i>y().min([null===(r=we.cpu)||void 0===r?void 0:r.remaining,X.max_containers_per_session]))){e.next=4;break}return e.abrupt("return",Promise.reject(K("session.launcher.EnqueueComputeSessionWarning")));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,b.jsx)(ue,{min:1,max:t,disabled:1===t,sliderProps:{marks:(0,d.Z)((0,d.Z)({1:"1"},null!==(i=t.cpu)&&void 0!==i&&i.remaining?(0,a.Z)({},null===(r=t.cpu)||void 0===r?void 0:r.remaining,{label:(0,b.jsx)(_e,{})}):{}),{},(0,a.Z)({},t,t)),tooltip:{formatter:function(){return"".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0," ").concat(o)}}},inputNumberProps:{addonAfter:o},onChange:function(e){e>1&&R.setFieldValue("num_of_sessions",1)}})})}})})]})})})]})},_e=function(){var e=h.Z.useToken().token;return(0,b.jsx)(E.Z,{style:{position:"absolute",top:-24,transform:"translateX(-50%)",color:e.colorSuccess,opacity:.5},children:(0,b.jsx)(he.Z,{})})},Pe=Z.memo(ke),we=function(e){var n=Object.assign({},((0,q.Z)(e),e)),i=(0,A.$G)().t;return(0,b.jsx)(N.Z.Item,(0,d.Z)((0,d.Z)({label:i("session.launcher.SessionName"),name:"name",rules:[{max:64,message:i("session.Validation.SessionNameTooLong64")},{pattern:/^(?:[a-zA-Z0-9][-a-zA-Z0-9._]{2,}[a-zA-Z0-9])?$/,message:i("session.Validation.PleaseFollowSessionNameRule").toString()}]},n),{},{children:(0,b.jsx)(M.Z,{allowClear:!0})}))},Se=i(93433),Fe=i(91278),Ce=i(37007),Te=function(e){var n=e.vFolderFrgmt,r=void 0===n?null:n,t=e.permission,o=(0,X.useFragment)(void 0!==l?l:l=i(750),r),s=y().chain({r:"green",w:"blue",d:"red"}).map((function(e,n){if(function(e,n){return!(null===e||void 0===e||!e.includes(n))||!(null===e||void 0===e||!e.includes("w")||"r"!==n)}((null===o||void 0===o?void 0:o.permission)||t,n))return{label:n.toUpperCase(),color:e}})).compact().value();return(0,b.jsx)(Ce.Z,{values:s})},Ee=i(56713),Ve=i(50708),Ie=i(72842),Ne=i(227),Me=i(49248),Ae=["filter","showAliasInput","selectedRowKeys","onChangeSelectedRowKeys","aliasBasePath","aliasMap","onChangeAliasMap","rowKey"],Re=function(e){var n=e.filter,i=e.showAliasInput,r=void 0!==i&&i,t=e.selectedRowKeys,o=void 0===t?[]:t,l=e.onChangeSelectedRowKeys,a=e.aliasBasePath,v=void 0===a?"/home/work/":a,p=e.aliasMap,h=e.onChangeAliasMap,f=e.rowKey,x=void 0===f?"name":f,j=(0,m.Z)(e,Ae),k=Z.useMemo((function(){return function(e){return e&&e[x]}}),[x]),P=(0,_.Z)({value:o,onChange:l},{defaultValue:[]}),w=(0,c.Z)(P,2),F=w[0],C=w[1],V=(0,_.Z)({value:p,onChange:h},{defaultValue:{}}),I=(0,c.Z)(V,2),R=I[0],K=I[1],D=N.Z.useForm(),O=(0,c.Z)(D,1)[0];(0,Z.useEffect)((function(){R&&(O.setFieldsValue(y().mapValues(R,(function(e){return e.startsWith(v)?e.slice(v.length):e}))),O.validateFields())}),[R,O,v]);var z=(0,A.$G)().t,q=(0,$.y3)(),L=(0,B.qh)(),U=(0,B.Kr)("first"),W=(0,c.Z)(U,2),Q=W[0],G=W[1],H=(0,Z.useTransition)(),X=(0,c.Z)(H,2),J=X[0],ee=X[1],ne=(0,Y.h)({queryKey:["VFolderSelectQuery",Q],queryFn:function(){return q({method:"GET",url:"/folders?group_id=".concat(L.id)})},staleTime:0}).data,re=(0,Z.useState)(""),te=(0,c.Z)(re,2),oe=te[0],le=te[1],se=y().filter(ne,(function(e){return!!F.includes(k(e))||(!n||n(e))&&(!oe||e.name.includes(oe))})),ae=function(e){null===e||void 0===e||e.preventDefault(),O.validateFields().then((function(e){})).catch((function(){})).finally((function(){K(y().mapValues(y().pickBy(O.getFieldsValue(),(function(e){return!!e})),(function(e,n){return ue(n,e)})))}))},ue=function(e,n){return y().isEmpty(n)?"".concat(v).concat(e):null!==n&&void 0!==n&&n.startsWith("/")?n:"".concat(v).concat(n)},ce=(0,T.useShadowRoot)(),de=[{title:(0,b.jsxs)(E.Z,{direction:"row",gap:"xxs",children:[(0,b.jsx)(ie.Z.Text,{children:z("data.folders.Name")}),r&&(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(ie.Z.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",z("session.launcher.FolderAlias")," ",(0,b.jsx)(Ne.Z,{title:(0,b.jsx)(A.cC,{i18nKey:"session.launcher.DescFolderAlias"}),style:{zIndex:1e4},getPopupContainer:function(){return ce},children:(0,b.jsx)(Ee.Z,{})}),")"]})})]}),dataIndex:"name",sorter:function(e,n){return e.name.localeCompare(n.name)},render:function(e,n){var i=F.includes(k(n));return(0,b.jsxs)(E.Z,{direction:"column",align:"stretch",gap:"xxs",style:r&&i?{display:"inline-flex",height:70,width:"100%"}:void 0,children:[(0,b.jsx)(Fe.Z,{keyword:oe,children:e}),r&&i&&(0,b.jsx)(N.Z.Item,{noStyle:!0,shouldUpdate:function(e,i){return e[k(n)]!==i[k(n)]},children:function(){var e=y()(F).reduce((function(e,n){return e[n]=(null===R||void 0===R?void 0:R[n])||ue(n,void 0),e}),{});return(0,b.jsx)(N.Z.Item,{name:k(n),rules:[{type:"string",pattern:/^[a-zA-Z0-9_/-]*$/,message:z("session.launcher.FolderAliasInvalid")},{type:"string",validator:function(){var i=(0,u.Z)((0,s.Z)().mark((function i(r,t){return(0,s.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!t||!y().some(e,(function(e,i){return i!==k(n)&&e===ue(k(n),t)}))){i.next=2;break}return i.abrupt("return",Promise.reject(z("session.launcher.FolderAliasOverlapping")));case 2:return i.abrupt("return",Promise.resolve());case 3:case"end":return i.stop()}}),i)})));return function(e,n){return i.apply(this,arguments)}}()}],extra:ue(n.name,O.getFieldValue(k(n))),children:(0,b.jsx)(M.Z,{onClick:function(e){e.stopPropagation()},placeholder:z("session.launcher.FolderAlias"),onChange:ae,allowClear:!0})})}})]})},fixed:"left"},{title:z("data.UsageMode"),dataIndex:"usage_mode",sorter:function(e,n){return e.usage_mode.localeCompare(n.usage_mode)}},{title:z("data.Host"),dataIndex:"host"},{title:z("data.Type"),dataIndex:"type",sorter:function(e,n){return e.type.localeCompare(n.type)},render:function(e,n){return(0,b.jsxs)(E.Z,{direction:"column",children:["user"===n.type?(0,b.jsx)(Ve.Z,{title:"User"}):(0,b.jsx)("div",{children:"Group"}),"group"===n.type&&"(".concat(n.group_name,")")]})}},{title:z("data.Permission"),dataIndex:"permission",sorter:function(e,n){return e.permission.localeCompare(n.permission)},render:function(e,n){return(0,b.jsx)(Te,{permission:n.permission})}},{title:z("data.Created"),dataIndex:"created_at",sorter:function(e,n){return e.created_at.localeCompare(n.created_at)},render:function(e,n){return S()(e).format("L")}}];return(0,b.jsxs)(E.Z,{direction:"column",align:"stretch",gap:"xs",children:[(0,b.jsxs)(E.Z,{direction:"row",gap:"xs",justify:"between",children:[(0,b.jsx)(M.Z,{value:oe,onChange:function(e){return le(e.target.value)},allowClear:!0,placeholder:z("data.SearchByName")}),(0,b.jsx)(g.ZP,{loading:J,icon:(0,b.jsx)(Ie.Z,{}),onClick:function(){ee((function(){G()}))}})]}),(0,b.jsx)(N.Z,{form:O,children:(0,b.jsx)(Me.Z,(0,d.Z)({scroll:{x:"max-content"},rowKey:k,rowSelection:{selectedRowKeys:F,onChange:function(e){C(e),ae()}},showSorterTooltip:!1,columns:de,dataSource:se,onRow:function(e,n){return{onClick:function(n){var i,r=n.target;null!==r&&void 0!==r&&null!==(i=r.classList)&&void 0!==i&&i.contains("ant-table-selection-column")&&(n.stopPropagation(),F.includes(k(e))?C(F.filter((function(n){return n!==k(e)}))):C([].concat((0,Se.Z)(F),[k(e)])))}}}},j))})]})},Ke=function(e){var n=Object.assign({},((0,q.Z)(e),e)),i=N.Z.useFormInstance(),r=(0,A.$G)().t;return N.Z.useWatch("vfoldersAliasMap",i),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(N.Z.Item,{hidden:!0,name:"vfoldersAliasMap",rules:[{validator:function(e,n){var t=y().chain(i.getFieldValue("mounts")).reduce((function(e,i){return e[i]=n[i]||"/home/work/"+i,e}),{}).values().value();return y().uniq(t).length!==t.length?Promise.reject(r("session.launcher.FolderAliasOverlapping")):Promise.resolve()}}],children:(0,b.jsx)(M.Z,{})}),(0,b.jsx)(N.Z.Item,(0,d.Z)((0,d.Z)({name:"mounts"},n),{},{valuePropName:"selectedRowKeys",trigger:"onChangeSelectedRowKeys",children:(0,b.jsx)(Re,{rowKey:"name",showAliasInput:!0,aliasMap:i.getFieldValue("vfoldersAliasMap"),onChangeAliasMap:function(e){i.setFieldValue("vfoldersAliasMap",e),i.validateFields(["vfoldersAliasMap"])},pagination:!1})}))]})},De=i(92331),Oe=i(91428),ze=i(70442),qe=i(84239),Be=i(89898),Le=i(99269),Ue=i(90632),We=i(46734),Qe=i(88464),Ge=i(60284),$e=i(41366),He=i(14634),Xe=i(93448),Je=i(52176),Ye=i(32461),en=i(48196),nn=i(17490),rn=i(12674),tn=i(4996),on=i(5936),ln=i(55144),sn=(0,d.Z)({sessionType:"interactive",allocationPreset:"custom",hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"},batch:{enabled:!1,command:void 0,scheduleDate:void 0},envvars:[]},{resource:{cpu:0,mem:"0g",shmem:"0g",accelerator:0},num_of_sessions:1,cluster_mode:"single-node",cluster_size:1,enabledAutomaticShmem:!0}),an=(0,ln.withDefault)(ln.NumberParam,0),un=(0,ln.withDefault)(ln.JsonParam,sn),cn=function(e){var n=e.form,i=e.containerCount,r=void 0===i?1:i;return(0,b.jsxs)(b.Fragment,{children:[y().map(y().omit(n.getFieldValue("resource"),"shmem","accelerator","acceleratorType"),(function(e,i){var t,o;return(0,b.jsx)(de.ZP,{type:i,value:"mem"===i?((null===(t=(0,$.PZ)(e,"b"))||void 0===t?void 0:t.number)||0)*r+"":y().toNumber(e)*r+"",opts:{shmem:n.getFieldValue("resource").shmem?((null===(o=(0,$.PZ)(n.getFieldValue("resource").shmem,"b"))||void 0===o?void 0:o.number)||0)*r:void 0}},i)})),y().isNumber(n.getFieldValue(["resource","accelerator"]))&&(0,b.jsx)(de.ZP,{type:n.getFieldValue(["resource","acceleratorType"]),value:y().toString(n.getFieldValue(["resource","accelerator"])*r)})]})},dn=function(){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<8;i++)e+=n.charAt(Math.floor(62*Math.random()));return e+"-session"},mn=function(){for(var e,n=Math.floor(52*Math.random()*52*52),i="",r=0;r<3;r++)i+=(e=n%52)<26?String.fromCharCode(65+e):String.fromCharCode(97+e-26),n=Math.floor(n/52);return i},vn=function(){var e,n,i,r,t,o,l,m="normal",v=(0,Z.useState)(!1),p=(0,c.Z)(v,2),x=p[0],j=p[1],_=(0,ln.useQueryParams)({step:an,formValues:un,redirectTo:ln.StringParam}),P=(0,c.Z)(_,2),w=P[0],F=w.step,V=w.formValues,I=w.redirectTo,R=P[1],K=(0,rn.s0)(),q=(0,T.useWebComponentInfo)().moveTo,W=(0,B.Dj)(),H=(0,B.qh)(),X=(0,Ue.Z)((function(){console.log("syncFormToURLWithDebounce",oe.getFieldsValue()),R({formValues:y().omit(oe.getFieldsValue(),["environments.image"])},"replaceIn")}),{leading:!1,wait:500,trailing:!0}).run,J=function(e){R({step:e},"pushIn")},Y=h.Z.useToken().token,ee=(0,A.$G)().t,re=We.ZP.useBreakpoint(),te=N.Z.useForm(),oe=(0,c.Z)(te,1)[0];(0,Z.useEffect)((function(){JSON.stringify(sn)!==JSON.stringify(V)&&(oe.setFieldsValue(V),oe.validateFields().catch((function(e){})))}),[]),(0,Z.useEffect)((function(){}),[F]);var le=N.Z.useWatch("sessionType",{form:oe,preserve:!0})||oe.getFieldValue("sessionType")||V.sessionType,se=y().filter([{title:ee("session.launcher.SessionType"),key:"sessionType"},{title:"".concat(ee("session.launcher.Environments")," & ").concat(ee("session.launcher.ResourceAllocation")," "),key:"environment"},"inference"!==le&&{title:ee("webui.menu.Data&Storage"),key:"storage"},{title:ee("session.launcher.Network"),key:"network"},{title:ee("session.launcher.ConfirmAndLaunch"),icon:(0,b.jsx)(De.Z,{}),key:"review"}],(function(e){return!!e})),ae=null===(e=se[F])||void 0===e?void 0:e.key,ue=y().some(oe.getFieldsError(),(function(e){return e.errors.length>0})),ce=function(){oe.validateFields().catch((function(e){})).finally((function(){J(se.length-1)}))};return(0,b.jsxs)(E.Z,{direction:"column",align:"stretch",style:{padding:Y.paddingSM,width:"100%",justifyContent:"revert"},children:[(0,b.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),I&&(0,b.jsx)(Ge.Z,{items:[{title:ee("webui.menu.Sessions"),onClick:function(e){e.preventDefault(),q(I)},href:I},{title:ee("session.launcher.StartNewSession")}]}),(0,b.jsxs)(E.Z,{direction:"row",gap:"md",align:"start",children:[(0,b.jsxs)(E.Z,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:[(0,b.jsxs)(E.Z,{direction:"row",justify:"between",children:[(0,b.jsx)(ie.Z.Title,{level:3,style:{marginTop:0},children:ee("session.launcher.StartNewSession")}),(0,b.jsxs)(E.Z,{direction:"row",gap:"sm",children:[(0,b.jsx)($e.Z,{title:ee("button.Reset"),description:ee("session.launcher.ResetFormConfirm"),onConfirm:function(){oe.resetFields(),K("/session/start")},icon:(0,b.jsx)(Ee.Z,{style:{color:Y.colorError}}),okText:ee("button.Reset"),okButtonProps:{danger:!0},children:(0,b.jsx)(g.ZP,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:ee("button.Reset")})}),(0,b.jsx)(g.ZP,{type:"link",icon:(0,b.jsx)(Oe.Z,{}),disabled:!0,style:{paddingRight:0,paddingLeft:0},children:ee("session.launcher.TemplateAndHistory")})]})]}),(0,b.jsx)(N.Z.Provider,{onFormChange:function(e,n){X()},children:(0,b.jsx)(N.Z,{form:oe,layout:"vertical",requiredMark:"optional",initialValues:sn,children:(0,b.jsxs)(E.Z,{direction:"column",align:"stretch",gap:"md",children:[(0,b.jsxs)(f.Z,{title:ee("session.launcher.SessionType"),style:{display:"sessionType"===ae?"block":"none"},children:[(0,b.jsx)(N.Z.Item,{name:"sessionType",children:(0,b.jsx)(Ze.ZP.Group,{className:"session-type-radio-group",options:[{label:(0,b.jsxs)(E.Z,{direction:"column",align:"start",style:{marginBottom:Y.marginXS},children:[(0,b.jsx)(ie.Z.Text,{strong:!0,children:"\ud83c\udfc3\u200d\u2640\ufe0f Make, test and run"}),(0,b.jsxs)(ie.Z.Text,{type:"secondary",children:[(0,b.jsx)(ie.Z.Text,{code:!0,children:"Interactive mode"})," ","allows you to create, test and run code interactively via jupyter notebook, visual studio code, etc."]})]}),value:"interactive"},{label:(0,b.jsxs)(E.Z,{direction:"column",align:"start",children:[(0,b.jsx)(ie.Z.Text,{strong:!0,children:"\u231a\ufe0f Start an long-running task"}),(0,b.jsxs)(ie.Z.Text,{type:"secondary",children:[(0,b.jsx)(ie.Z.Text,{code:!0,children:"Batch mode"})," ","runs your code with multiple node & clusters to scale your idea"]})]}),value:"batch"}]})}),(0,b.jsx)(we,{})]}),"batch"===le&&(0,b.jsxs)(f.Z,{title:ee("session.launcher.BatchModeConfig"),style:{display:"sessionType"===ae?"block":"none"},children:[(0,b.jsx)(N.Z.Item,{label:ee("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,b.jsx)(M.Z.TextArea,{autoSize:!0})}),(0,b.jsx)(N.Z.Item,{label:ee("session.launcher.SessionStartTime"),children:(0,b.jsxs)(E.Z,{direction:"row",gap:"xs",children:[(0,b.jsx)(N.Z.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,b.jsx)(He.Z,{onChange:function(e){e.target.checked&&y().isEmpty(oe.getFieldValue(["batch","scheduleDate"]))?oe.setFieldValue(["batch","scheduleDate"],S()().add(2,"minutes").toISOString()):!1===e.target.checked&&oe.setFieldValue(["batch","scheduleDate"],void 0)},children:ee("session.launcher.Enable")})}),(0,b.jsx)(N.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,r;return(null===(i=e.batch)||void 0===i?void 0:i.enabled)!==(null===(r=n.batch)||void 0===r?void 0:r.enabled)},children:function(){var e,n=!0!==(null===(e=oe.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(N.Z.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(n,i){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i||!S()(i).isBefore(S()())){e.next=2;break}return e.abrupt("return",Promise.reject(ee("session.launcher.StartTimeMustBeInTheFuture")));case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,b.jsx)(C,{disabled:n,showTime:!0,localFormat:!0,disabledDate:function(e){return e.isBefore(S()().startOf("day"))}})})})}})]})})]}),"inference"===le&&(0,b.jsx)(f.Z,{title:"Inference Mode Configuration",children:(0,b.jsx)(N.Z.Item,{name:["inference","vFolderName"],label:ee("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,b.jsx)(L.Z,{})})}),(0,b.jsxs)(f.Z,{title:ee("session.launcher.Environments"),style:{display:"environment"===ae?"block":"none"},children:[(0,b.jsx)(nn.SV,{fallbackRender:function(e){return console.log(e),null},children:(0,b.jsx)(O.Z,{})}),(0,b.jsx)(N.Z.Item,{label:"Environment Variables",children:(0,b.jsx)(D,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,b.jsx)(f.Z,{title:ee("session.launcher.ResourceAllocation"),style:{display:"environment"===ae?"block":"none"},children:(0,b.jsx)(Pe,{enableNumOfSessions:!0})}),(0,b.jsxs)(f.Z,{title:ee("session.launcher.HPCOptimization"),style:{display:"environment"===ae?"block":"none"},children:[(0,b.jsx)(N.Z.Item,{noStyle:!0,children:(0,b.jsxs)(E.Z,{direction:"row",gap:"sm",children:[(0,b.jsx)(ie.Z.Text,{children:ee("session.launcher.SwitchOpenMPoptimization")}),(0,b.jsx)(N.Z.Item,{label:ee("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,b.jsx)(ge.Z,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:function(e){e&&oe.setFieldsValue(y().pick(sn,["hpcOptimization"]))}})})]})}),(0,b.jsx)(N.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,r;return(null===(i=e.hpcOptimization)||void 0===i?void 0:i.autoEnabled)!==(null===(r=n.hpcOptimization)||void 0===r?void 0:r.autoEnabled)},children:function(){var e=oe.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,b.jsxs)(xe.Z,{gutter:Y.marginMD,style:{display:e?"none":void 0,marginTop:Y.marginMD},children:[(0,b.jsx)(ye.Z,{xs:24,sm:12,children:(0,b.jsx)(N.Z.Item,{style:{flex:1},label:ee("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,b.jsxs)(b.Fragment,{children:[ee("session.launcher.OpenMPOptimization"),(0,b.jsx)(A.cC,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,b.jsx)(ne.Z,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,b.jsx)(ye.Z,{xs:24,sm:12,children:(0,b.jsx)(N.Z.Item,{style:{flex:1},label:ee("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,b.jsxs)(b.Fragment,{children:[ee("session.launcher.OpenMPOptimization"),(0,b.jsx)(A.cC,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,b.jsx)(ne.Z,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,b.jsx)(f.Z,{title:ee("webui.menu.Data&Storage"),style:{display:"storage"===ae?"block":"none"},children:(0,b.jsx)(Ke,{})}),(0,b.jsx)(f.Z,{title:ee("session.launcher.Network"),style:{display:"network"===ae?"block":"none"},children:(0,b.jsx)(G,{})}),"review"===ae&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k,{title:ee("session.launcher.SessionType"),size:"small",status:oe.getFieldError("name").length>0||oe.getFieldError(["batch","command"]).length>0||oe.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:ee("button.Edit"),onClickExtraButton:function(){J(se.findIndex((function(e){return"sessionType"===e.key})))},children:(0,b.jsxs)(Xe.Z,{size:"small",children:[(0,b.jsx)(Xe.Z.Item,{label:ee("session.SessionType"),span:24,children:oe.getFieldValue("sessionType")}),!y().isEmpty(oe.getFieldValue("name"))&&(0,b.jsx)(Xe.Z.Item,{label:ee("session.launcher.SessionName"),span:24,children:oe.getFieldValue("name")}),"batch"===le&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Xe.Z.Item,{label:ee("session.launcher.StartUpCommand"),span:24,children:(0,b.jsx)(M.Z.TextArea,{readOnly:!0,autoSize:!0,value:oe.getFieldValue(["batch","command"])})}),(0,b.jsx)(Xe.Z.Item,{label:ee("session.launcher.ScheduleTimeSimple"),span:24,children:S()(oe.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)")})]})]})}),(0,b.jsx)(k,{title:ee("session.launcher.Environments"),size:"small",status:y().some(oe.getFieldValue("envvars"),(function(e,n){return oe.getFieldError(["envvars",n,"variable"]).length>0||oe.getFieldError(["envvars",n,"value"]).length>0}))?"error":void 0,extraButtonTitle:ee("button.Edit"),onClickExtraButton:function(){J(se.findIndex((function(e){return"environment"===e.key})))},children:(0,b.jsxs)(Xe.Z,{size:"small",column:2,children:[(0,b.jsx)(Xe.Z.Item,{label:ee("session.launcher.Project"),children:H.name}),(0,b.jsx)(Xe.Z.Item,{label:ee("general.ResourceGroup"),children:oe.getFieldValue("resourceGroup")}),(0,b.jsx)(Xe.Z.Item,{label:ee("general.Image"),span:2,children:(0,b.jsxs)(E.Z,{direction:"row",gap:"xs",style:{flex:1},children:[(0,b.jsx)(z.Z,{image:null===(n=oe.getFieldValue("environments"))||void 0===n?void 0:n.version}),(0,b.jsx)(ie.Z.Text,{copyable:!0,code:!0,children:null===(i=oe.getFieldValue("environments"))||void 0===i?void 0:i.version})]})}),(null===(r=oe.getFieldValue("envvars"))||void 0===r?void 0:r.length)>0&&(0,b.jsx)(Xe.Z.Item,{label:ee("session.launcher.EnvironmentVariable"),children:null!==(t=oe.getFieldValue("envvars"))&&void 0!==t&&t.length?(0,b.jsx)(tn.Z,{style:on.Z,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:y().map(oe.getFieldValue("envvars"),(function(e){return"".concat((null===e||void 0===e?void 0:e.variable)||"",'="').concat((null===e||void 0===e?void 0:e.value)||"",'"')})).join("\n")}):(0,b.jsx)(ie.Z.Text,{type:"secondary",children:"-"})})]})}),(0,b.jsx)(k,{title:ee("session.launcher.ResourceAllocation"),status:y().some(oe.getFieldValue("resource"),(function(e,n){return oe.getFieldError(["resource",n]).length>0}))?"error":void 0,size:"small",extraButtonTitle:ee("button.Edit"),onClickExtraButton:function(){J(se.findIndex((function(e){return"environment"===e.key})))},children:(0,b.jsxs)(E.Z,{direction:"column",align:"stretch",children:[y().some(oe.getFieldValue("resource"),(function(e,n){return oe.getFieldWarning(["resource",n]).length>0}))&&(0,b.jsx)(Je.Z,{type:"warning",showIcon:!0,message:ee("session.launcher.EnqueueComputeSessionWarning")}),(0,b.jsxs)(Xe.Z,{column:2,children:[(0,b.jsx)(Xe.Z.Item,{label:ee("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,b.jsxs)(E.Z,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===oe.getFieldValue("allocationPreset")?"":(0,b.jsx)(U.Z,{children:oe.getFieldValue("allocationPreset")}),(0,b.jsx)(cn,{form:oe})]})}),(0,b.jsx)(Xe.Z.Item,{label:ee("session.launcher.NumberOfContainer"),children:1===oe.getFieldValue("cluster_size")?oe.getFieldValue("num_of_sessions"):oe.getFieldValue("cluster_size")}),(0,b.jsx)(Xe.Z.Item,{label:ee("session.launcher.ClusterMode"),children:"single-node"===oe.getFieldValue("cluster_mode")?ee("session.launcher.SingleNode"):ee("session.launcher.MultiNode")})]}),(0,b.jsx)(f.Z,{size:"small",type:"inner",title:ee("session.launcher.TotalAllocation"),children:(0,b.jsx)(E.Z,{direction:"row",gap:"xxs",children:(0,b.jsx)(cn,{form:oe,containerCount:1===oe.getFieldValue("cluster_size")?oe.getFieldValue("num_of_sessions"):oe.getFieldValue("cluster_size")})})})]})}),(0,b.jsx)(k,{title:ee("webui.menu.Data&Storage"),size:"small",status:oe.getFieldError("vfoldersAliasMap").length>0?"error":void 0,extraButtonTitle:ee("button.Edit"),onClickExtraButton:function(){J(se.findIndex((function(e){return"storage"===e.key})))},children:(null===(o=oe.getFieldValue("mounts"))||void 0===o?void 0:o.length)>0?(0,b.jsx)(Me.Z,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:ee("data.folders.Name")},{dataIndex:"alias",title:ee("session.launcher.FolderAlias"),render:function(e,n){return y().isEmpty(e)?(0,b.jsx)(ie.Z.Text,{type:"secondary",style:{opacity:.7},children:"/home/work/".concat(n.name)}):e}}],dataSource:y().map(oe.getFieldValue("mounts"),(function(e){var n;return{name:e,alias:null===(n=oe.getFieldValue("vfoldersAliasMap"))||void 0===n?void 0:n[e]}}))}):(0,b.jsx)(Je.Z,{type:"warning",showIcon:!0,message:ee("session.launcher.NoFolderMounted")})}),(0,b.jsx)(k,{title:"Network",size:"small",status:oe.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:ee("button.Edit"),onClickExtraButton:function(){J(se.findIndex((function(e){return"network"===e.key})))},children:(0,b.jsx)(Xe.Z,{size:"small",children:(0,b.jsx)(Xe.Z.Item,{label:ee("session.launcher.PreOpenPortTitle"),children:(0,b.jsxs)(E.Z,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[y().sortBy(oe.getFieldValue("ports"),(function(e){return parseInt(e)})).map((function(e){return(0,b.jsx)(Q,{value:e,style:{margin:0},children:e})})),y().isArray(oe.getFieldValue("ports"))&&0!==(null===(l=oe.getFieldValue("ports"))||void 0===l?void 0:l.length)?null:(0,b.jsx)(ie.Z.Text,{type:"secondary",children:ee("general.None")})]})})})})]}),(0,b.jsxs)(E.Z,{direction:"row",justify:"between",children:[(0,b.jsx)(E.Z,{gap:"sm",children:F===se.length-1&&(0,b.jsx)(g.ZP,{icon:(0,b.jsx)(ze.Z,{}),disabled:!0,onClick:function(){Qe.ZP.info("Not implemented yet: Template edit modal")},children:"Save as a template"})}),(0,b.jsxs)(E.Z,{direction:"row",gap:"sm",children:[F!==se.length-1&&(0,b.jsx)(g.ZP,{onClick:ce,children:"Skip to Review"}),F>0&&(0,b.jsx)(g.ZP,{onClick:function(){J(F-1)},icon:(0,b.jsx)(qe.Z,{}),disabled:x,children:"Previous"}),F===se.length-1?(0,b.jsx)(g.ZP,{type:"primary",icon:(0,b.jsx)(Be.Z,{}),disabled:ue,onClick:function(){j(!0),oe.validateFields().then(function(){var e=(0,u.Z)((0,s.Z)().mark((function e(n){var i,r,t,o,l,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.environments.version.split("@"),r=(0,c.Z)(i,2),t=r[0],o=r[1],l={kernelName:t,architecture:o,sessionName:y().isEmpty(n.name)?dn():n.name,config:(0,d.Z)((0,d.Z)((0,d.Z)({type:n.sessionType},"batch"===n.sessionType?{startsAt:n.batch.enabled?n.batch.scheduleDate:void 0,startupCommand:n.batch.command}:{}),{},{group_name:H.name,domain:W._config.domainName,scaling_group:n.resourceGroup,cluster_mode:n.cluster_mode,cluster_size:n.cluster_size,maxWaitSeconds:15,cpu:n.resource.cpu,mem:n.resource.mem,shmem:(0,$.p)(n.resource.mem,"4g")>0&&(0,$.p)(n.resource.shmem,"1g")<0?"1g":n.resource.shmem},n.resource.accelerator>0?(0,a.Z)({},n.resource.acceleratorType,n.resource.accelerator):void 0),{},{mounts:n.mounts,mount_map:n.vfoldersAliasMap,env:(0,d.Z)((0,d.Z)({},y().fromPairs(n.envvars.map((function(e){return[e.variable,e.value]})))),y().omit(n.hpcOptimization,"autoEnabled")),preopen_ports:y().map(n.ports,(function(e){return parseInt(e)}))})},u=y().map(y().range(n.num_of_sessions||1),(function(e){var i=(n.num_of_sessions||1)>1?"".concat(l.sessionName,"-").concat(mn(),"-").concat(e):l.sessionName;return W.createIfNotExists(l.kernelName,i,l.config,2e4,l.architecture).then((function(e){return null!==e&&void 0!==e&&e.created||Qe.ZP.warning(ee("session.launcher.SessionAlreadyExists")),e})).catch((function(e){throw console.log(e),e}))})),e.next=5,Promise.all(u).then((function(e){var i=(0,c.Z)(e,1)[0];if(1===n.num_of_sessions&&"batch"!==n.sessionType){var r,t=i;r="kernelId"in t?{"session-name":t.kernelId,"access-key":"",mode:m}:{"session-uuid":t.sessionId,"session-name":t.sessionName,"access-key":"",mode:m};var o=t.servicePorts;!0===Array.isArray(o)?r["app-services"]=o.map((function(e){return e.name})):r["app-services"]=[],o.length>0&&globalThis.appLauncher.showLauncher(r)}K("/job",{}),q("/job")})).catch((function(){}));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("validation errors",e)})).finally((function(){j(!1)}))},loading:x,children:ee("session.launcher.Launch")}):(0,b.jsxs)(g.ZP,{type:"primary",ghost:!0,onClick:function(){J(F+1)},children:["Next ",(0,b.jsx)(Le.Z,{})]})]})]})]})})})]}),re.lg&&(0,b.jsx)(Ye.Z,{offsetTop:150,style:{zIndex:2},children:(0,b.jsx)(en.Z,{size:"small",direction:"vertical",current:F,onChange:function(e){e===se.length-1?ce():J(e)},items:y().map(se,(function(e,n){return(0,d.Z)((0,d.Z)({},e),{},{status:n===F?"process":"wait"})}))})})]})]})}}}]);
//# sourceMappingURL=383.99ed16a4.chunk.js.map