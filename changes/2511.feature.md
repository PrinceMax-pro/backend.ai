refactor route selection in wsproxy component and add tests
